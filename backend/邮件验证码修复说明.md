# 邮件验证码功能修复指南

## 问题描述

邮箱验证码功能出现500错误，导致无法正常发送验证码和进行用户注册。

## 解决方案

本次更新修复了以下问题：

1. 修复了前端和后端API路径不匹配的问题
2. 改进了错误处理机制，确保前端能正确显示错误信息
3. 增强了邮件发送服务的稳定性和重试机制
4. 添加了详细的日志记录，便于排查问题

## 配置步骤

### 1. 配置环境文件

首先，确保在 `backend` 目录下有正确配置的 `.env` 文件：

```bash
# 如果没有.env文件，复制示例文件
cp env.example .env
```

然后编辑 `.env` 文件，配置以下邮件相关参数：

```
# 邮件配置 - 用于发送验证码
SMTP_HOST="smtp.gmail.com"  # 邮件服务器地址
SMTP_PORT=587               # 邮件服务器端口
SMTP_SECURE=false           # 是否使用SSL/TLS (587端口通常为false，465端口通常为true)
SMTP_USER="your-email@gmail.com"  # 邮箱账号
SMTP_PASS="your-app-password"     # 邮箱密码或应用专用密码
EMAIL_FROM="your-email@gmail.com"  # 发件人地址
```

> **注意**：如果使用Gmail，需要开启"应用专用密码"功能，普通密码可能无法通过身份验证。

### 2. 测试邮件服务

配置完成后，可以使用测试工具验证邮件服务是否正常工作：

```bash
# Windows
test-email.bat

# Linux/Mac
node test-email-service.js
```

按照提示输入测试邮箱，验证邮件是否能正常发送。

### 3. 启动服务

确认邮件服务正常后，启动增强认证服务：

```bash
# Windows
start-enhanced.bat

# Linux/Mac
node src/server-enhanced.ts
```

## 常见问题

### 1. 邮件发送失败

可能的原因：
- SMTP配置错误
- 邮箱密码错误或需要应用专用密码
- 邮件服务器拒绝连接（可能需要在邮箱设置中允许不安全应用访问）

解决方法：
- 检查环境变量配置
- 确认邮箱账号和密码正确
- 检查邮箱安全设置

### 2. Redis连接失败

邮件验证码功能依赖Redis服务，确保Redis服务已启动：

```bash
# Windows
redis-server.exe

# Linux
systemctl start redis
```

### 3. 验证码发送成功但前端仍报错

可能的原因：
- 前端和后端API路径不匹配
- 错误处理格式不一致

解决方法：
- 检查前端API调用路径是否正确
- 确认后端返回的错误格式是否与前端期望的一致

## 技术支持

如有其他问题，请联系技术支持团队。 