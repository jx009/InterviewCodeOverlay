<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¤è¯çŠ¶æ€æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #ffffff;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid;
        }
        .success { border-color: #10b981; background: rgba(16, 185, 129, 0.1); }
        .error { border-color: #ef4444; background: rgba(239, 68, 68, 0.1); }
        .info { border-color: #3b82f6; background: rgba(59, 130, 246, 0.1); }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #2563eb; }
        .logs {
            background: #111;
            padding: 15px;
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>ğŸ” è®¤è¯çŠ¶æ€ä¸€è‡´æ€§æµ‹è¯•</h1>
    
    <div class="status info">
        <h3>æµ‹è¯•ç›®æ ‡</h3>
        <p>éªŒè¯ç™»å½•ååœ¨ä¸åŒé¡µé¢é—´åˆ‡æ¢æ—¶ï¼Œå¯¼èˆªæ çš„è®¤è¯çŠ¶æ€æ˜¯å¦ä¿æŒä¸€è‡´</p>
    </div>

    <div class="controls">
        <button onclick="checkAuthStatus()">æ£€æŸ¥è®¤è¯çŠ¶æ€</button>
        <button onclick="simulateLogin()">æ¨¡æ‹Ÿç™»å½•</button>
        <button onclick="simulateLogout()">æ¨¡æ‹Ÿç™»å‡º</button>
        <button onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
    </div>

    <div id="status-display" class="status info">
        <h3>å½“å‰çŠ¶æ€</h3>
        <p id="current-status">æ£€æŸ¥ä¸­...</p>
    </div>

    <div class="logs">
        <h3>æµ‹è¯•æ—¥å¿—</h3>
        <div id="logs"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('logs');
            const color = type === 'error' ? '#ef4444' : type === 'success' ? '#10b981' : '#3b82f6';
            logElement.innerHTML += `<div style="color: ${color};">[${timestamp}] ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function updateStatus(status, isAuthenticated, hasUser, hasSessionId) {
            const statusElement = document.getElementById('current-status');
            const statusDisplay = document.getElementById('status-display');
            
            statusElement.innerHTML = `
                <strong>è®¤è¯çŠ¶æ€:</strong> ${isAuthenticated ? 'âœ… å·²è®¤è¯' : 'âŒ æœªè®¤è¯'}<br>
                <strong>ç”¨æˆ·ä¿¡æ¯:</strong> ${hasUser ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}<br>
                <strong>SessionId:</strong> ${hasSessionId ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}<br>
                <strong>çŠ¶æ€ä¸€è‡´æ€§:</strong> ${isAuthenticated === (hasUser || hasSessionId) ? 'âœ… ä¸€è‡´' : 'âŒ ä¸ä¸€è‡´'}
            `;
            
            statusDisplay.className = `status ${isAuthenticated ? 'success' : 'error'}`;
        }

        function checkAuthStatus() {
            log('ğŸ” å¼€å§‹æ£€æŸ¥è®¤è¯çŠ¶æ€...');
            
            // æ¨¡æ‹Ÿæ£€æŸ¥localStorage
            const sessionId = localStorage.getItem('sessionId');
            const hasSessionId = !!sessionId;
            
            // æ¨¡æ‹Ÿæ£€æŸ¥ç”¨æˆ·çŠ¶æ€ï¼ˆå®é™…ä¸­è¿™ä¼šæ¥è‡ªReactçŠ¶æ€ï¼‰
            const userStr = localStorage.getItem('mockUser');
            const hasUser = !!userStr;
            
            // è®¡ç®—è®¤è¯çŠ¶æ€
            const isAuthenticated = hasUser || hasSessionId;
            
            log(`ğŸ“‹ SessionId: ${hasSessionId ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}`);
            log(`ğŸ‘¤ ç”¨æˆ·ä¿¡æ¯: ${hasUser ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}`);
            log(`ğŸ” è®¤è¯çŠ¶æ€: ${isAuthenticated ? 'å·²è®¤è¯' : 'æœªè®¤è¯'}`);
            
            updateStatus('checked', isAuthenticated, hasUser, hasSessionId);
            
            if (isAuthenticated === (hasUser || hasSessionId)) {
                log('âœ… è®¤è¯çŠ¶æ€ä¸€è‡´æ€§æ£€æŸ¥é€šè¿‡', 'success');
            } else {
                log('âŒ è®¤è¯çŠ¶æ€ä¸ä¸€è‡´ï¼', 'error');
            }
        }

        function simulateLogin() {
            log('ğŸ”„ æ¨¡æ‹Ÿç™»å½•æµç¨‹...');
            
            // æ¨¡æ‹Ÿè®¾ç½®sessionIdå’Œç”¨æˆ·ä¿¡æ¯
            const mockSessionId = 'session_' + Date.now();
            const mockUser = JSON.stringify({
                id: '1',
                username: 'testuser',
                email: 'test@example.com'
            });
            
            localStorage.setItem('sessionId', mockSessionId);
            localStorage.setItem('mockUser', mockUser);
            
            log(`ğŸ”‘ å·²è®¾ç½®SessionId: ${mockSessionId.substring(0, 15)}...`);
            log('ğŸ‘¤ å·²è®¾ç½®ç”¨æˆ·ä¿¡æ¯');
            log('âœ… æ¨¡æ‹Ÿç™»å½•å®Œæˆ', 'success');
            
            // æ£€æŸ¥çŠ¶æ€
            setTimeout(checkAuthStatus, 100);
        }

        function simulateLogout() {
            log('ğŸšª æ¨¡æ‹Ÿç™»å‡ºæµç¨‹...');
            
            localStorage.removeItem('sessionId');
            localStorage.removeItem('mockUser');
            
            log('ğŸ—‘ï¸ å·²æ¸…é™¤SessionId');
            log('ğŸ—‘ï¸ å·²æ¸…é™¤ç”¨æˆ·ä¿¡æ¯');
            log('âœ… æ¨¡æ‹Ÿç™»å‡ºå®Œæˆ', 'success');
            
            // æ£€æŸ¥çŠ¶æ€
            setTimeout(checkAuthStatus, 100);
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.onload = function() {
            log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹æ£€æŸ¥...');
            checkAuthStatus();
        };

        // ç›‘å¬localStorageå˜åŒ–
        window.addEventListener('storage', function(e) {
            if (e.key === 'sessionId' || e.key === 'mockUser') {
                log(`ğŸ“¡ æ£€æµ‹åˆ°localStorageå˜åŒ–: ${e.key}`, 'info');
                setTimeout(checkAuthStatus, 100);
            }
        });
    </script>
</body>
</html> 