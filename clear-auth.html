
<!DOCTYPE html>
<html>
<head>
    <title>æ¸…ç†localStorage</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #1a1a1a; 
            color: #fff; 
        }
        .container { 
            max-width: 600px; 
            margin: 0 auto; 
            background: #2a2a2a; 
            padding: 20px; 
            border-radius: 8px; 
        }
        .status { 
            margin: 10px 0; 
            padding: 10px; 
            border-radius: 4px; 
        }
        .success { background: #2d5a2d; }
        .info { background: #2d4a5a; }
        .warning { background: #5a4a2d; }
        button { 
            background: #007acc; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 5px; 
        }
        button:hover { background: #005a99; }
        .danger { background: #cc3333; }
        .danger:hover { background: #aa1111; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ å¼ºåˆ¶æ¸…ç†ç™»å½•çŠ¶æ€</h1>
        <div id="status"></div>
        
        <h2>å½“å‰localStorageçŠ¶æ€:</h2>
        <div id="current-status"></div>
        
        <h2>æ“ä½œ:</h2>
        <button onclick="checkStatus()">ğŸ” æ£€æŸ¥å½“å‰çŠ¶æ€</button>
        <button onclick="clearAllAuth()" class="danger">ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰è®¤è¯æ•°æ®</button>
        <button onclick="testClean()">âœ… æµ‹è¯•æ¸…ç†æ•ˆæœ</button>
        
        <h2>è¯´æ˜:</h2>
        <div class="info status">
            <p>å¦‚æœä½ çœ‹åˆ°"æ­£åœ¨è·³è½¬åˆ°ä»ªè¡¨ç›˜"è€Œä¸æ˜¯ç™»å½•è¡¨å•ï¼Œè¯´æ˜localStorageä¸­è¿˜æœ‰è®¤è¯æ•°æ®ã€‚</p>
            <p>ç‚¹å‡»"æ¸…é™¤æ‰€æœ‰è®¤è¯æ•°æ®"æŒ‰é’®ï¼Œç„¶åé‡æ–°æ‰“å¼€ç™»å½•é¡µé¢ã€‚</p>
        </div>
    </div>

    <script>
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = '<div class="status ' + type + '">' + message + '</div>';
        }
        
        function updateCurrentStatus() {
            const currentDiv = document.getElementById('current-status');
            const sessionId = localStorage.getItem('sessionId');
            const sessionIdBackup = localStorage.getItem('sessionId_backup');
            const lastActivity = localStorage.getItem('lastActivity');
            const token = localStorage.getItem('token');
            
            let html = '<div class="status info">';
            html += '<p><strong>sessionId:</strong> ' + (sessionId ? sessionId.substring(0, 20) + '...' : 'æœªè®¾ç½®') + '</p>';
            html += '<p><strong>sessionId_backup:</strong> ' + (sessionIdBackup ? sessionIdBackup.substring(0, 20) + '...' : 'æœªè®¾ç½®') + '</p>';
            html += '<p><strong>lastActivity:</strong> ' + (lastActivity || 'æœªè®¾ç½®') + '</p>';
            html += '<p><strong>token:</strong> ' + (token ? token.substring(0, 20) + '...' : 'æœªè®¾ç½®') + '</p>';
            html += '</div>';
            
            currentDiv.innerHTML = html;
        }
        
        function checkStatus() {
            updateCurrentStatus();
            
            const sessionId = localStorage.getItem('sessionId');
            const sessionIdBackup = localStorage.getItem('sessionId_backup');
            
            if (sessionId || sessionIdBackup) {
                updateStatus('âš ï¸ å‘ç°è®¤è¯æ•°æ®ï¼è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ çœ‹åˆ°"æ­£åœ¨è·³è½¬åˆ°ä»ªè¡¨ç›˜"çš„åŸå› ã€‚', 'warning');
            } else {
                updateStatus('âœ… æ²¡æœ‰å‘ç°è®¤è¯æ•°æ®ï¼Œåº”è¯¥èƒ½æ­£å¸¸æ˜¾ç¤ºç™»å½•è¡¨å•ã€‚', 'success');
            }
        }
        
        function clearAllAuth() {
            console.log('ğŸ—‘ï¸ å¼€å§‹æ¸…é™¤æ‰€æœ‰è®¤è¯æ•°æ®...');
            
            // æ¸…é™¤æ‰€æœ‰å¯èƒ½çš„è®¤è¯ç›¸å…³æ•°æ®
            const keysToRemove = [
                'sessionId',
                'sessionId_backup', 
                'lastActivity',
                'token',
                'user',
                'authToken',
                'refresh_token',
                'access_token'
            ];
            
            let removedCount = 0;
            keysToRemove.forEach(key => {
                if (localStorage.getItem(key)) {
                    localStorage.removeItem(key);
                    console.log('ğŸ—‘ï¸ å·²åˆ é™¤:', key);
                    removedCount++;
                }
            });
            
            // æ¸…é™¤æ‰€æœ‰cookies
            document.cookie.split(";").forEach(function(c) { 
                document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
            });
            
            updateStatus('âœ… å·²æ¸…é™¤ ' + removedCount + ' ä¸ªè®¤è¯æ•°æ®é¡¹å’Œæ‰€æœ‰cookiesã€‚ç°åœ¨åˆ·æ–°é¡µé¢åº”è¯¥èƒ½çœ‹åˆ°ç™»å½•è¡¨å•äº†ï¼', 'success');
            updateCurrentStatus();
            
            console.log('âœ… è®¤è¯æ•°æ®æ¸…ç†å®Œæˆ');
        }
        
        function testClean() {
            checkStatus();
            const sessionId = localStorage.getItem('sessionId');
            const sessionIdBackup = localStorage.getItem('sessionId_backup');
            
            if (!sessionId && !sessionIdBackup) {
                updateStatus('âœ… æ¸…ç†æˆåŠŸï¼ç°åœ¨å¯ä»¥å…³é—­æ­¤é¡µé¢ï¼Œé‡æ–°æ‰“å¼€ç™»å½•é¡µé¢äº†ã€‚', 'success');
            } else {
                updateStatus('âŒ è¿˜æœ‰æ®‹ç•™æ•°æ®ï¼Œè¯·ç‚¹å‡»"æ¸…é™¤æ‰€æœ‰è®¤è¯æ•°æ®"æŒ‰é’®ã€‚', 'warning');
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥çŠ¶æ€
        window.onload = function() {
            checkStatus();
        };
    </script>
</body>
</html>
