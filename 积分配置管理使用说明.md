# 积分配置管理功能使用说明

## 🎯 功能概述

此功能为Interview Code Overlay项目添加了完整的积分系统管理界面，允许管理员通过Web界面配置不同AI模型的积分消耗。

## 🚀 快速开始

### 1. 启动后端服务
```bash
cd InterviewCodeOverlay/backend
npm start
# 或使用批处理文件
start-enhanced.bat
```

### 2. 启动Web管理界面
```bash
cd InterviewCodeOverlay/web
npm run dev
# 或使用批处理文件
启动脚本.bat
```

### 3. 访问管理界面
- **主要配置中心**: http://localhost:3000
- **积分配置管理**: http://localhost:3000/manager

## 👤 用户权限

只有**管理员账户**（用户名为`admin`）才能访问积分配置管理功能。

## 📋 功能详述

### 🔧 积分配置管理 (`/manager`)

#### 主要功能：
1. **查看配置列表** - 显示所有已配置的模型积分消耗
2. **添加新配置** - 为新的AI模型添加积分配置
3. **编辑配置** - 修改现有模型的积分消耗
4. **删除配置** - 移除不需要的配置
5. **批量管理** - 支持批量操作（后端已实现）

#### 配置项说明：
- **模型名称**: AI模型的标识符（如：`gpt-4`, `claude-3-sonnet`）
- **题目类型**: 
  - `multiple_choice` - 选择题
  - `programming` - 编程题
- **积分消耗**: 使用该模型处理对应类型题目消耗的积分数量
- **描述**: 可选的配置说明

### 🎛️ 管理员控制面板

在主配置页面，管理员可以看到：
- **个人配置** - 个人AI模型和系统设置
- **管理员面板** - 包含积分配置管理入口

## 🛠️ API接口

### 管理员API (需要admin权限)

#### 获取所有模型配置
```http
GET /api/admin/model-configs
Authorization: Bearer {sessionId}
```

#### 创建/更新模型配置
```http
PUT /api/admin/model-configs
Authorization: Bearer {sessionId}
Content-Type: application/json

{
  "modelName": "gpt-4",
  "questionType": "multiple_choice",
  "cost": 2,
  "description": "GPT-4处理选择题"
}
```

#### 删除模型配置
```http
DELETE /api/admin/model-configs
Authorization: Bearer {sessionId}
Content-Type: application/json

{
  "modelName": "gpt-4",
  "questionType": "multiple_choice"
}
```

#### 批量更新配置
```http
POST /api/admin/model-configs/batch
Authorization: Bearer {sessionId}
Content-Type: application/json

{
  "configs": [
    {
      "modelName": "gpt-4",
      "questionType": "multiple_choice",
      "cost": 2,
      "description": "GPT-4处理选择题"
    },
    ...
  ]
}
```

## 💡 推荐配置

### GPT系列
- **GPT-4**
  - 选择题: 2-3积分
  - 编程题: 5-8积分
- **GPT-3.5-turbo**
  - 选择题: 1-2积分
  - 编程题: 3-5积分

### Claude系列
- **Claude-3-Opus**
  - 选择题: 3积分
  - 编程题: 6积分
- **Claude-3-Sonnet**
  - 选择题: 2积分
  - 编程题: 4积分

### Gemini系列
- **Gemini-Pro**
  - 选择题: 2积分
  - 编程题: 4积分

## 🔄 搜题流程

当用户进行搜题时，系统会：

1. **预检查积分** - 验证用户积分是否充足
2. **扣除积分** - 从用户账户扣除相应积分
3. **执行搜题** - 调用AI模型进行分析
4. **处理结果** - 成功返回结果，失败则退还积分

## 📊 数据库结构

### ModelPointConfig表
- `id` - 主键
- `modelName` - 模型名称
- `questionType` - 题目类型 (`multiple_choice` | `programming`)
- `cost` - 积分消耗
- `isActive` - 是否启用
- `description` - 配置描述
- `createdAt` - 创建时间
- `updatedAt` - 更新时间

### PointTransaction表
- `id` - 主键
- `userId` - 用户ID
- `transactionType` - 交易类型 (`consume` | `recharge` | `refund` | `reward`)
- `amount` - 积分数量
- `balanceAfter` - 操作后余额
- `modelName` - 相关模型名称
- `questionType` - 题目类型
- `description` - 交易描述
- `createdAt` - 创建时间

## 🚨 故障排除

### 常见问题

1. **无法访问管理页面**
   - 确认使用管理员账户登录
   - 检查后端服务是否正常运行

2. **配置保存失败**
   - 检查网络连接
   - 确认积分值为正整数
   - 验证模型名称格式

3. **积分扣除异常**
   - 检查配置是否存在
   - 确认用户积分充足
   - 查看后端日志

### 调试命令

```bash
# 检查数据库连接
cd backend && npm run db:check

# 初始化默认配置
cd backend && node src/scripts/init-point-configs.ts

# 测试积分系统
cd backend && node test-points-system.js
```

## 🔧 开发说明

### 文件结构
```
backend/
├── src/
│   ├── routes/admin.ts          # 管理员API路由
│   ├── services/PointService.ts # 积分服务逻辑
│   ├── types/points.ts          # 类型定义
│   └── scripts/init-point-configs.ts # 初始化脚本
│
web/
├── src/
│   ├── pages/
│   │   ├── DashboardPage.tsx    # 主配置页面
│   │   └── ManagerPage.tsx      # 积分管理页面
│   └── App.tsx                  # 路由配置
```

### 扩展功能

可以基于现有架构添加：
- 积分统计图表
- 用户积分管理
- 配置导入/导出
- 模型使用统计
- 自动积分调整

## 📝 更新日志

- **v1.0.0** - 初始版本
  - 积分配置CRUD功能
  - 管理员权限控制
  - Web界面管理
  - API接口完整实现

---

如有问题，请联系开发团队或查看项目文档。 